{"version":3,"file":"bare-bones-logger.js","sources":["src/wrap.js","src/dom.js","src/withFileSystemWarning.js","src/http.js","src/io.js","src/user.js","src/webSocket.js"],"sourcesContent":["function mangle(name) {\r\n  return \"_\" + name;\r\n}\r\n\r\nfunction wrapFunction(target, send, name) {\r\n  var orig = name;\r\n  while (target[orig]) {\r\n    orig = mangle(orig);\r\n  }\r\n  if(target[name]) {\r\n    target[orig] = target[name];\r\n  } else {\r\n    orig = null;\r\n  }\r\n  target[name] = function () {\r\n    var args = [];\r\n    for (var i = 0; i < arguments.length; ++i) {\r\n      var elem = arguments[i];\r\n      if(elem === null) {\r\n        args.push(\"null\");\r\n      }\r\n      else if(elem === undefined) {\r\n        args.push(\"undefined\");\r\n      }\r\n      else if (typeof elem === \"object\" && !(elem instanceof String)) {\r\n        var obj1 = elem,\r\n          obj2 = {};\r\n        for (var key in obj1) {\r\n          obj2[key] = obj1[key];\r\n          if (obj2[key] !== null && obj2[key] !== undefined) {\r\n            obj2[key] = obj2[key].toString();\r\n          }\r\n        }\r\n        args.push(obj2);\r\n      }\r\n      else {\r\n        args.push(elem.toString());\r\n      }\r\n    }\r\n\r\n    var obj = send({ name, args });\r\n    if (orig && target[orig] && obj) {\r\n      target[orig].apply(target, arguments);\r\n    }\r\n  };\r\n}\r\n\r\nfunction onError(target, message, source, lineno, colno, error) {\r\n  colno = colno || window.event && window.event.errorCharacter;\r\n  var done = false,\r\n    name = \"error\",\r\n    stack = error && error.stack;\r\n\r\n  if(!stack){\r\n    if(arguments.callee){\r\n      var head = arguments.callee.caller;\r\n      while(head){\r\n        stack.push(head.name);\r\n        head = head.caller;\r\n      }\r\n    }\r\n    else{\r\n      stack = \"N/A\";\r\n    }\r\n  }\r\n\r\n  var data = {\r\n      type: \"error\",\r\n      time: (new Date())\r\n        .toLocaleTimeString(),\r\n      message: message,\r\n      source: source,\r\n      lineno: lineno,\r\n      colno: colno,\r\n      error: error.message,\r\n      stack: stack\r\n    };\r\n\r\n  while (!done && target[name]) {\r\n    try {\r\n      target[name](data);\r\n      done = true;\r\n    }\r\n    catch (exp) {\r\n      name = mangle(name);\r\n    }\r\n  }\r\n}\r\n\r\nexport default function wrap(send, target = console, redirects = [\"log\", \"info\", \"error\"]) {\r\n  if (send !== null) {\r\n    redirects.forEach((name) =>\r\n      wrapFunction(target, send, name));\r\n  }\r\n\r\n  window.addEventListener(\"error\", function(evt){\r\n    onError(target, evt.message, evt.filename, evt.lineno, evt.colno, evt.error);\r\n  }, false);\r\n\r\n  return target;\r\n};","import wrap from \"./wrap\";\r\n\r\nexport default function dom(host, target, redirects) {\r\n  const output = document.querySelector(host);\r\n  return wrap(function (data) {\r\n    const elem = document.createElement(\"pre\");\r\n    elem.appendChild(document.createTextNode(JSON.stringify(data)));\r\n    output.appendChild(elem);\r\n    return data;\r\n  }, target, redirects);\r\n}\r\n","function identity(data) {\r\n  return data;\r\n}\r\n\r\nexport default function withFileSystemWarning(thunk) {\r\n  const isBad = location.protocol === \"file:\";\r\n\r\n  if(isBad) {\r\n    console.warn(\"Can't perform HTTP requests from the file system. Not going to setup the error proxy, but will setup the error catch-all.\");\r\n  }\r\n\r\n  return isBad ? identity : thunk;\r\n};","import wrap from \"./wrap\";\r\nimport withFileSystemWarning from \"./withFileSystemWarning\";\r\n\r\nexport default function http(host, target, redirects) {\r\n  return wrap(withFileSystemWarning(function (data) {\r\n    var req = new XMLHttpRequest();\r\n    req.open(\"POST\", host);\r\n    req.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\r\n    req.send(JSON.stringify(data));\r\n    return data;\r\n  }), target, redirects);\r\n}\r\n","import wrap from \"./wrap\";\nimport withFileSystemWarning from \"./withFileSystemWarning\";\nimport io from \"socket.io/lib/client\";\n\nexport default function socketio(host, target, redirects) {\n  const socket = io(host);\n  return wrap(withFileSystemWarning(function (data) {\n    socket.emit(\"logging\", data);\n    return data;\n  }), target, redirects);\n}\n","import wrap from \"./wrap\";\r\n\r\nexport default function user(host, target, redirects) {\r\n  if (!(host instanceof Function)) {\r\n    console.warn(\"The host parameter was expected to be a function, but it was\", host);\r\n  }\r\n  else {\r\n    return wrap(host, target, redirects);\r\n  }\r\n}","import wrap from \"./wrap\";\r\nimport withFileSystemWarning from \"./withFileSystemWarning\";\r\n\r\nexport default function webSocket(host, target, redirects) {\r\n  const socket = new WebSocket(host);\r\n  return wrap(withFileSystemWarning(function (data) {\r\n    socket.send(JSON.stringify(data));\r\n    return data;\r\n  }), target, redirects);\r\n}\r\n"],"names":["mangle","name","wrapFunction","target","send","orig","args","i","arguments","length","elem","push","undefined","String","obj1","obj2","key","toString","obj","apply","onError","message","source","lineno","colno","error","window","event","errorCharacter","done","stack","callee","head","caller","data","Date","toLocaleTimeString","exp","wrap","console","redirects","forEach","addEventListener","evt","filename","dom","host","output","document","querySelector","createElement","appendChild","createTextNode","JSON","stringify","identity","withFileSystemWarning","thunk","isBad","location","protocol","warn","http","req","XMLHttpRequest","open","setRequestHeader","socketio","socket","io","emit","user","Function","webSocket","WebSocket"],"mappings":"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"}