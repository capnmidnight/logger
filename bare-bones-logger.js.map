{"version":3,"file":null,"sources":["src/logger/setup.js","src/index.js"],"sourcesContent":["var send = null;\r\n\r\nfunction mangle(name) {\r\n  return \"_\" + name;\r\n}\r\n\r\nfunction wrap(name) {\r\n  var orig = name;\r\n  while (console[orig]) {\r\n    orig = mangle(orig);\r\n  }\r\n  console[orig] = console[name];\r\n  return function () {\r\n    var args = [];\r\n    for (var i = 0; i < arguments.length; ++i) {\r\n      var elem = arguments[i];\r\n      if (typeof elem === \"object\" && !(elem instanceof String)) {\r\n        var obj1 = elem,\r\n          obj2 = {};\r\n        for (var key in obj1) {\r\n          obj2[key] = obj1[key];\r\n          if (obj2[key] !== null && obj2[key] !== undefined) {\r\n            obj2[key] = obj2[key].toString();\r\n          }\r\n        }\r\n        args.push(obj2);\r\n      }\r\n      else if(elem) {\r\n        args.push(elem.toString());\r\n      }\r\n      else{\r\n        args.push(\"null\");\r\n      }\r\n    }\r\n    var obj = send({\r\n      name,\r\n      args\r\n    });\r\n    if (obj) {\r\n      console[orig].apply(console, arguments);\r\n    }\r\n  };\r\n}\r\n\r\nfunction onError(message, source, lineno, colno, error) {\r\n  colno = colno || window.event && window.event.errorCharacter;\r\n  var done = false,\r\n    name = \"error\",\r\n    stack = error && error.stack;\r\n\r\n  if(!stack){\r\n    if(arguments.callee){\r\n      var head = arguments.callee.caller;\r\n      while(head){\r\n        stack.push(head.name);\r\n        head = head.caller;\r\n      }\r\n    }\r\n    else{\r\n      stack = \"N/A\";\r\n    }\r\n  }\r\n\r\n  var data = {\r\n      type: \"error\",\r\n      time: (new Date())\r\n        .toLocaleTimeString(),\r\n      message: message,\r\n      source: source,\r\n      lineno: lineno,\r\n      colno: colno,\r\n      error: error.message,\r\n      stack: stack\r\n    };\r\n\r\n  while (!done && console[name]) {\r\n    try {\r\n      console[name](data);\r\n      done = true;\r\n    }\r\n    catch (exp) {\r\n      name = mangle(name);\r\n    }\r\n  }\r\n}\r\n\r\nexport default function setup(type, target, redirects) {\r\n  if (type !== logger.DISABLED) {\r\n    if ((type === logger.HTTP || type === logger.WEBSOCKET) && location.protocol === \"file:\") {\r\n      console.warn(\"Can't perform HTTP requests from the file system. Not going to setup the error proxy, but will setup the error catch-all.\");\r\n    }\r\n    else if (type === logger.HTTP) {\r\n      send = function (data) {\r\n        var req = new XMLHttpRequest();\r\n        req.open(\"POST\", target);\r\n        req.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\r\n        req.send(JSON.stringify(data));\r\n        return data;\r\n      };\r\n    }\r\n    else if (type === logger.WEBSOCKET) {\r\n      var socket = new WebSocket(target);\r\n      send = function (data) {\r\n        socket.send(JSON.stringify(data));\r\n        return data;\r\n      };\r\n    }\r\n    else if (type === logger.DOM) {\r\n      var output = document.querySelector(target);\r\n      send = function (data) {\r\n        var elem = document.createElement(\"pre\");\r\n        elem.appendChild(document.createTextNode(JSON.stringify(data)));\r\n        output.appendChild(elem);\r\n        return data;\r\n      };\r\n    }\r\n    else if (type === logger.USER) {\r\n      if (!(target instanceof Function)) {\r\n        console.warn(\"The target parameter was expected to be a function, but it was\", target);\r\n      }\r\n      else {\r\n        send = target;\r\n      }\r\n    }\r\n\r\n    if (send !== null) {\r\n      redirects = redirects || [\"log\", \"info\", \"error\"];\r\n      redirects.forEach(function (n) {\r\n        console[n] = wrap(n);\r\n      });\r\n    }\r\n\r\n    window.addEventListener(\"error\", function(evt){\r\n      onError(evt.message, evt.filename, evt.lineno, evt.colno, evt.error);\r\n    }, false);\r\n  }\r\n}","import setup from \"./logger/setup\";\r\nexport { setup };\r\n\r\nexport var DISABLED = 0;\r\nexport var HTTP = 1;\r\nexport var WEBSOCKET = 2;\r\nexport var DOM = 3;\r\nexport var USER = 4;\r\n"],"names":["send","mangle","name","wrap","orig","console","args","i","arguments","length","elem","String","obj1","obj2","key","undefined","toString","push","obj","apply","onError","message","source","lineno","colno","error","window","event","errorCharacter","done","stack","callee","head","caller","data","Date","toLocaleTimeString","exp","setup","type","target","redirects","logger","DISABLED","HTTP","WEBSOCKET","location","protocol","warn","req","XMLHttpRequest","open","setRequestHeader","JSON","stringify","socket","WebSocket","DOM","output","document","querySelector","createElement","appendChild","createTextNode","USER","Function","forEach","n","addEventListener","evt","filename"],"mappings":"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"}